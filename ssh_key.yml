---
- name: ssh deploy
  hosts: all

  vars_files:
    - ssh_pass.yml

  tasks:
    - name: create key
      connection: local
      command: "ssh-keygen -b 2048 -t rsa -f {{ lookup('env','HOME') }}/.ssh/id_rsa -q -N ''"
      ignore_errors: yes
      run_once: true

    - name: push key
      authorized_key:
        user: root
        state: present
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
